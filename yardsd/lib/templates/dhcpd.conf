# GENERATED BY YARDS
{% for vlan in vlans %}
shared-network {{ vlan.vlan_name }} {
    {% for range in vlan.ranges %}
    subnet {{ range.iprange.networkid }} netmask {{ range.netmask }} {
        authoritative;
        default-lease-time {{ range.iprange.default_lease_time }};
        max-lease-time {{ range.iprange.max_lease_time }};
        min-lease-time {{ range.iprange.min_lease_time }};
        option routers {{ range.iprange.gateway }};
        option domain-name-servers {{ range.iprange.default_dns }};
        option domain-name "{{ range.iprange.dns_domain }}";
        {% for pool in range.dhcp %}
        pool {
            range {{ pool.dhcpstart }} {{ pool.dhcpend }};
            {% if pool.jail %}
            allow unknown clients;
            {% else %}
            allow members of "NETWORK{{ range.iprange.id }}";
            {% endif %}
        }
        {% endfor %}
    }
    {% endfor %}
}
{% endfor %}

{% for vlan in vlans %}
{% for range in vlan.ranges %}
class "NETWORK{{ range.iprange.id }}" {
    match pick-first-value (hardware, option dhcp-client-identifier);
}
{% endfor %}
{% endfor %}

{% for vlan in vlans %}
{% for range in vlan.ranges %}
{% for address in range.addresses %}
# {{ address.name }} {{ address.interface }} ({{ address.owner }})
{% if address.address.iptype == "Static" %}
host {{ address.hash }} {
    hardware ethernet {{ address.interface }};
    fixed-address {{ address.static_addr }};
}
subclass "NETWORK{{ range.iprange.id }}" {{ address.interface }}
{% else %}
host {{ address.hash }} {
    hardware ethernet {{ address.interface }};
}
subclass "NETWORK{{ range.iprange.id }}" {{ address.interface }}
{% endif %}
{% endfor %}
{% endfor %}
{% endfor %}
